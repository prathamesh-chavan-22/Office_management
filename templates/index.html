<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HR Management System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/feather-icons@4.29.0/dist/feather.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <!-- Logo/Brand -->
        <div class="sidebar-header">
            <div class="sidebar-brand">
                <i data-feather="briefcase"></i>
                <span class="brand-text">HR System</span>
            </div>
            <button class="sidebar-toggle d-lg-none" onclick="toggleSidebar()">
                <i data-feather="x"></i>
            </button>
        </div>

        <!-- User Info -->
        <div class="sidebar-user">
            <div class="user-avatar">
                <i data-feather="user"></i>
            </div>
            <div class="user-info">
                <div class="user-name" id="sidebar-username">User</div>
                <div class="user-role" id="sidebar-role">Role</div>
            </div>
        </div>

        <!-- Navigation Menu -->
        <nav class="sidebar-nav">
            <ul class="nav-list">
                <li class="nav-item">
                    <a class="nav-link active" href="#" onclick="showSection('dashboard')">
                        <i data-feather="home"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" onclick="showSection('attendance')">
                        <i data-feather="clock"></i>
                        <span>Attendance</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" onclick="showSection('leaves')">
                        <i data-feather="calendar"></i>
                        <span>Leave Requests</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" onclick="showSection('payroll')">
                        <i data-feather="dollar-sign"></i>
                        <span>Payroll</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" onclick="showSection('performance')">
                        <i data-feather="trending-up"></i>
                        <span>Performance</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" onclick="showSection('tickets')">
                        <i data-feather="help-circle"></i>
                        <span>Support Tickets</span>
                    </a>
                </li>
                
                <!-- HR/Admin only sections -->
                <li class="nav-divider hr-only" style="display: none;">
                    <span>HR Management</span>
                </li>
                <li class="nav-item hr-only" style="display: none;">
                    <a class="nav-link" href="#" onclick="showSection('hr-leaves')">
                        <i data-feather="check-square"></i>
                        <span>Leave Management</span>
                    </a>
                </li>
                <li class="nav-item hr-only" style="display: none;">
                    <a class="nav-link" href="#" onclick="showSection('recruitment')">
                        <i data-feather="user-plus"></i>
                        <span>Recruitment</span>
                    </a>
                </li>
                <li class="nav-item admin-only" style="display: none;">
                    <a class="nav-link" href="#" onclick="showSection('admin')">
                        <i data-feather="users"></i>
                        <span>User Management</span>
                    </a>
                </li>
                
                <!-- General sections -->
                <li class="nav-divider">
                    <span>Personal</span>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" onclick="showSection('profile')">
                        <i data-feather="user"></i>
                        <span>Profile</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" onclick="showSection('settings')">
                        <i data-feather="settings"></i>
                        <span>Settings</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" onclick="showSection('chatbot')">
                        <i data-feather="message-circle"></i>
                        <span>AI Assistant</span>
                    </a>
                </li>
            </ul>
        </nav>

        <!-- Logout Button -->
        <div class="sidebar-footer">
            <button class="logout-btn" onclick="logout()">
                <i data-feather="log-out"></i>
                <span>Logout</span>
            </button>
        </div>
    </div>

    <!-- Top Bar -->
    <div class="topbar">
        <button class="sidebar-toggle d-lg-none" onclick="toggleSidebar()">
            <i data-feather="menu"></i>
        </button>
        <div class="topbar-title">
            <h1 id="page-title">Dashboard</h1>
        </div>
        <div class="topbar-actions">
            <div class="current-time" id="topbar-time">--:--:--</div>
        </div>
    </div>

    <!-- Sidebar Overlay for Mobile -->
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

    <!-- Login Modal -->
    <div class="modal fade" id="loginModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header border-0 pb-0">
                    <div class="text-center w-100">
                        <i data-feather="briefcase" class="text-primary mb-2" style="width: 3rem; height: 3rem;"></i>
                        <h4 class="modal-title fw-bold text-primary">HR Management System</h4>
                        <p class="text-muted mb-0">Please sign in to your account</p>
                    </div>
                </div>
                <div class="modal-body pt-2">
                    <form id="loginForm">
                        <div class="mb-3">
                            <label for="username" class="form-label">Username</label>
                            <input type="text" class="form-control form-control-lg" id="username" required placeholder="Enter your username">
                        </div>
                        <div class="mb-3">
                            <label for="password" class="form-label">Password</label>
                            <input type="password" class="form-control form-control-lg" id="password" required placeholder="Enter your password">
                        </div>
                        <div class="mb-4 text-center">
                            <small class="text-muted">
                                <i data-feather="info" class="me-1" style="width: 1rem; height: 1rem;"></i>
                                Demo credentials: <strong>admin</strong> / <strong>admin123</strong>
                            </small>
                        </div>
                        <button type="submit" class="btn btn-primary btn-lg w-100">
                            <i data-feather="log-in" class="me-2"></i> Sign In
                        </button>
                    </form>
                    <div id="loginError" class="alert alert-danger mt-3" style="display: none;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Dashboard Section -->
        <div id="dashboard-section" class="section">
            <div class="row">
                <div class="col-12">
                    <h1 class="mb-4">Dashboard</h1>
                </div>
            </div>
            
            <!-- Quick Stats Row -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="stats-card">
                        <div class="stats-number" id="totalEmployees">0</div>
                        <div class="stats-label">Total Employees</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stats-card">
                        <div class="stats-number" id="presentToday">0</div>
                        <div class="stats-label">Present Today</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stats-card">
                        <div class="stats-number" id="pendingLeaves">0</div>
                        <div class="stats-label">Pending Leaves</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stats-card">
                        <div class="stats-number" id="dashboardCurrentTime">--:--:--</div>
                        <div class="stats-label">Current Time</div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="quick-actions">
                <div class="quick-action-card" onclick="showSection('attendance'); clockIn()">
                    <i data-feather="clock"></i>
                    <h6>Clock In</h6>
                    <p>Record your attendance</p>
                </div>
                <div class="quick-action-card" onclick="showSection('leaves'); showLeaveForm()">
                    <i data-feather="calendar"></i>
                    <h6>Apply Leave</h6>
                    <p>Submit leave request</p>
                </div>
                <div class="quick-action-card" onclick="showSection('payroll')">
                    <i data-feather="dollar-sign"></i>
                    <h6>Payroll</h6>
                    <p>View salary details</p>
                </div>
                <div class="quick-action-card" onclick="showSection('profile')">
                    <i data-feather="user"></i>
                    <h6>Profile</h6>
                    <p>Update your profile</p>
                </div>
            </div>

            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h5>Recent Announcements</h5>
                        </div>
                        <div class="card-body">
                            <div id="recentAnnouncements">
                                <div class="text-center text-muted">
                                    <i data-feather="info"></i>
                                    <p>No announcements available</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Leaves Section -->
        <div id="leaves-section" class="section" style="display: none;">
            <div class="row">
                <div class="col-12">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h1>Leave Management</h1>
                        <button class="btn btn-primary" onclick="showLeaveForm()">
                            <i data-feather="plus"></i> Apply for Leave
                        </button>
                    </div>
                </div>
            </div>

            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Leave Statistics</h5>
                            <div class="row text-center">
                                <div class="col-4">
                                    <div class="text-primary">
                                        <strong id="pendingLeaves">0</strong>
                                        <small class="d-block">Pending</small>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="text-success">
                                        <strong id="approvedLeaves">0</strong>
                                        <small class="d-block">Approved</small>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="text-danger">
                                        <strong id="rejectedLeaves">0</strong>
                                        <small class="d-block">Rejected</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h5>My Leave Requests</h5>
                </div>
                <div class="card-body">
                    <div id="leavesTable">
                        <div class="text-center text-muted">
                            <i data-feather="calendar"></i>
                            <p>No leave requests found</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- HR Leave Management Section -->
        <div id="hr-leaves-section" class="section" style="display: none;">
            <div class="row">
                <div class="col-12">
                    <h1 class="mb-4">Leave Management</h1>
                </div>
            </div>

            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="card">
                        <div class="card-body text-center">
                            <div class="mb-2">
                                <i data-feather="clock" class="text-warning" style="width: 24px; height: 24px;"></i>
                            </div>
                            <h4 class="text-warning mb-1" id="totalPendingLeaves">0</h4>
                            <small class="text-muted">Pending Reviews</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card">
                        <div class="card-body text-center">
                            <div class="mb-2">
                                <i data-feather="check-circle" class="text-success" style="width: 24px; height: 24px;"></i>
                            </div>
                            <h4 class="text-success mb-1" id="totalApprovedLeaves">0</h4>
                            <small class="text-muted">This Month</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card">
                        <div class="card-body text-center">
                            <div class="mb-2">
                                <i data-feather="x-circle" class="text-danger" style="width: 24px; height: 24px;"></i>
                            </div>
                            <h4 class="text-danger mb-1" id="totalRejectedLeaves">0</h4>
                            <small class="text-muted">This Month</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card">
                        <div class="card-body text-center">
                            <div class="mb-2">
                                <i data-feather="users" class="text-info" style="width: 24px; height: 24px;"></i>
                            </div>
                            <h4 class="text-info mb-1" id="totalEmployees">0</h4>
                            <small class="text-muted">Total Employees</small>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5>All Leave Requests</h5>
                    <div>
                        <button class="btn btn-sm btn-outline-primary" onclick="app.loadAllLeaves()">
                            <i data-feather="refresh-cw"></i> Refresh
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div id="allLeavesTable">
                        <div class="text-center text-muted">
                            <i data-feather="calendar"></i>
                            <p>No leave requests found</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Attendance Section -->
        <div id="attendance-section" class="section" style="display: none;">
            <div class="row">
                <div class="col-12">
                    <h1 class="mb-4">Attendance</h1>
                </div>
            </div>

            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-body text-center">
                            <h5 class="card-title">Clock In/Out</h5>
                            <div class="mb-3">
                                <div class="h2" id="currentTime">--:--:--</div>
                                <div class="text-muted" id="currentDate">--/--/----</div>
                            </div>
                            <div class="d-grid gap-2">
                                <button id="clockInBtn" class="btn btn-success" onclick="clockIn()">
                                    <i data-feather="clock"></i> Clock In
                                </button>
                                <button id="clockOutBtn" class="btn btn-danger" onclick="clockOut()" disabled>
                                    <i data-feather="clock"></i> Clock Out
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Today's Summary</h5>
                            <div id="attendanceSummary">
                                <div class="d-flex justify-content-between">
                                    <span>Status:</span>
                                    <span id="attendanceStatus" class="badge bg-secondary">Not Started</span>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <span>Clock In:</span>
                                    <span id="todayClockIn">--:--:--</span>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <span>Clock Out:</span>
                                    <span id="todayClockOut">--:--:--</span>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <span>Hours Worked:</span>
                                    <span id="todayHours">0.0 hours</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h5>Attendance History</h5>
                </div>
                <div class="card-body">
                    <div id="attendanceHistory">
                        <div class="text-center text-muted">
                            <i data-feather="clock"></i>
                            <p>No attendance records found</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Payroll Section -->
        <div id="payroll-section" class="section" style="display: none;">
            <div class="row">
                <div class="col-12">
                    <h1 class="mb-4">Payroll</h1>
                </div>
            </div>

            <div class="row mb-4">
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-body text-center">
                            <h5 class="card-title">YTD Earnings</h5>
                            <div class="h3 text-success" id="ytdEarnings">$0.00</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-body text-center">
                            <h5 class="card-title">YTD Tax</h5>
                            <div class="h3 text-danger" id="ytdTax">$0.00</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-body text-center">
                            <h5 class="card-title">Latest Pay</h5>
                            <div class="h3 text-primary" id="latestPay">$0.00</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- HR Controls for Payroll Management -->
            <div id="payrollControls" class="card mb-4" style="display: none;">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5>Payroll Management</h5>
                    <button class="btn btn-primary" onclick="showAddPayrollForm()">
                        <i data-feather="plus"></i> Add Payroll Record
                    </button>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <label class="form-label">Filter by Employee</label>
                            <select class="form-select" id="employeeFilter" onchange="filterPayrollByEmployee()">
                                <option value="">All Employees</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Year</label>
                            <select class="form-select" id="yearFilter" onchange="filterPayroll()">
                                <option value="">All Years</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Month</label>
                            <select class="form-select" id="monthFilter" onchange="filterPayroll()">
                                <option value="">All Months</option>
                                <option value="1">January</option>
                                <option value="2">February</option>
                                <option value="3">March</option>
                                <option value="4">April</option>
                                <option value="5">May</option>
                                <option value="6">June</option>
                                <option value="7">July</option>
                                <option value="8">August</option>
                                <option value="9">September</option>
                                <option value="10">October</option>
                                <option value="11">November</option>
                                <option value="12">December</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label">&nbsp;</label>
                            <button class="btn btn-outline-secondary d-block" onclick="clearPayrollFilters()">Clear</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h5 id="payrollHistoryTitle">Payroll History</h5>
                </div>
                <div class="card-body">
                    <div id="payrollHistory">
                        <div class="text-center text-muted">
                            <i data-feather="dollar-sign"></i>
                            <p>No payroll records found</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add Payroll Modal -->
        <div class="modal fade" id="addPayrollModal" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Add Payroll Record</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <form id="addPayrollForm">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Employee <span class="text-danger">*</span></label>
                                        <select class="form-select" id="payrollEmployeeId" required>
                                            <option value="">Select Employee</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Status</label>
                                        <select class="form-select" id="payrollStatus">
                                            <option value="draft">Draft</option>
                                            <option value="approved">Approved</option>
                                            <option value="paid">Paid</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Pay Period Start <span class="text-danger">*</span></label>
                                        <input type="date" class="form-control" id="payPeriodStart" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Pay Period End <span class="text-danger">*</span></label>
                                        <input type="date" class="form-control" id="payPeriodEnd" required>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Basic Salary <span class="text-danger">*</span></label>
                                        <input type="number" step="0.01" class="form-control" id="basicSalary" required onchange="calculatePayroll()">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Allowances</label>
                                        <input type="number" step="0.01" class="form-control" id="allowances" value="0" onchange="calculatePayroll()">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Deductions</label>
                                        <input type="number" step="0.01" class="form-control" id="deductions" value="0" onchange="calculatePayroll()">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Tax Deduction</label>
                                        <input type="number" step="0.01" class="form-control" id="taxDeduction" value="0" onchange="calculatePayroll()">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Overtime Hours</label>
                                        <input type="number" step="0.1" class="form-control" id="overtimeHours" value="0" onchange="calculateOvertimePayroll()">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Overtime Pay</label>
                                        <input type="number" step="0.01" class="form-control" id="overtimePay" value="0" readonly>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label class="form-label">Gross Pay</label>
                                        <input type="number" step="0.01" class="form-control" id="grossPay" readonly>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label class="form-label">Total Deductions</label>
                                        <input type="number" step="0.01" class="form-control" id="totalDeductions" readonly>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label class="form-label"><strong>Net Pay</strong></label>
                                        <input type="number" step="0.01" class="form-control fw-bold" id="netPay" readonly>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" onclick="submitPayrollRecord()">Create Payroll Record</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Performance Section -->
        <div id="performance-section" class="section" style="display: none;">
            <div class="row">
                <div class="col-12">
                    <h1 class="mb-4">Performance</h1>
                </div>
            </div>

            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Performance Overview</h5>
                            <div class="row text-center">
                                <div class="col-6">
                                    <div class="text-primary">
                                        <strong id="totalReviews">0</strong>
                                        <small class="d-block">Total Reviews</small>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="text-success">
                                        <strong id="averageRating">-</strong>
                                        <small class="d-block">Avg Rating</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h5>Performance Reviews</h5>
                </div>
                <div class="card-body">
                    <div id="performanceReviews">
                        <div class="text-center text-muted">
                            <i data-feather="trending-up"></i>
                            <p>No performance reviews found</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Profile Section -->
        <div id="profile-section" class="section" style="display: none;">
            <div class="row">
                <div class="col-12">
                    <h1 class="mb-4">Profile</h1>
                </div>
            </div>

            <div class="row">
                <div class="col-md-8">
                    <div class="card">
                        <div class="card-header">
                            <h5>Personal Information</h5>
                        </div>
                        <div class="card-body">
                            <form id="profileForm">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">First Name</label>
                                            <input type="text" class="form-control" id="profileFirstName" required>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Last Name</label>
                                            <input type="text" class="form-control" id="profileLastName" required>
                                        </div>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Email</label>
                                    <input type="email" class="form-control" id="profileEmail" required>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Department</label>
                                            <input type="text" class="form-control" id="profileDepartment">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Position</label>
                                            <input type="text" class="form-control" id="profilePosition">
                                        </div>
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-primary">Update Profile</button>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-header">
                            <h5>Change Password</h5>
                        </div>
                        <div class="card-body">
                            <form id="passwordForm">
                                <div class="mb-3">
                                    <label class="form-label">Current Password</label>
                                    <input type="password" class="form-control" id="currentPassword" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">New Password</label>
                                    <input type="password" class="form-control" id="newPassword" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Confirm Password</label>
                                    <input type="password" class="form-control" id="confirmPassword" required>
                                </div>
                                <button type="submit" class="btn btn-warning">Change Password</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Section -->
        <div id="settings-section" class="section" style="display: none;">
            <div class="row">
                <div class="col-12">
                    <h1 class="mb-4">Settings</h1>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5>Preferences</h5>
                        </div>
                        <div class="card-body">
                            <form id="settingsForm">
                                <div class="mb-3">
                                    <label class="form-label">Theme</label>
                                    <select class="form-select" id="settingsTheme">
                                        <option value="light">Light</option>
                                        <option value="dark">Dark</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Language</label>
                                    <select class="form-select" id="settingsLanguage">
                                        <option value="en">English</option>
                                        <option value="es">Spanish</option>
                                        <option value="fr">French</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Timezone</label>
                                    <select class="form-select" id="settingsTimezone">
                                        <option value="UTC">UTC</option>
                                        <option value="America/New_York">Eastern Time</option>
                                        <option value="America/Los_Angeles">Pacific Time</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="settingsNotifications">
                                        <label class="form-check-label" for="settingsNotifications">
                                            Enable Notifications
                                        </label>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="settingsEmailNotifications">
                                        <label class="form-check-label" for="settingsEmailNotifications">
                                            Enable Email Notifications
                                        </label>
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-primary">Save Settings</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Chatbot Section -->
        <div id="chatbot-section" class="section" style="display: none;">
            <div class="row">
                <div class="col-12">
                    <h1 class="mb-4">AI Assistant</h1>
                </div>
            </div>

            <div class="row">
                <div class="col-md-8 mx-auto">
                    <div class="card">
                        <div class="card-header">
                            <h5>Chat with HR Assistant</h5>
                        </div>
                        <div class="card-body">
                            <div id="chatMessages" style="height: 400px; overflow-y: auto; border: 1px solid var(--bs-border-color); padding: 1rem; border-radius: 0.375rem;">
                                <div class="text-center text-muted">
                                    <i data-feather="message-circle"></i>
                                    <p>Start a conversation with the HR Assistant</p>
                                </div>
                            </div>
                            <form id="chatForm" class="mt-3">
                                <div class="input-group">
                                    <input type="text" class="form-control" id="chatInput" placeholder="Type your message...">
                                    <button class="btn btn-primary" type="submit">Send</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Admin Section -->
        <div id="admin-section" class="section admin-only" style="display: none;">
            <div class="row">
                <div class="col-12">
                    <h1 class="mb-4">Admin Panel</h1>
                </div>
            </div>

            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="card">
                        <div class="card-body text-center">
                            <h5 class="card-title">Total Users</h5>
                            <div class="h3 text-primary" id="adminTotalUsers">0</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card">
                        <div class="card-body text-center">
                            <h5 class="card-title">Active Users</h5>
                            <div class="h3 text-success" id="adminActiveUsers">0</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card">
                        <div class="card-body text-center">
                            <h5 class="card-title">Pending Leaves</h5>
                            <div class="h3 text-warning" id="adminPendingLeaves">0</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card">
                        <div class="card-body text-center">
                            <h5 class="card-title">Today's Attendance</h5>
                            <div class="h3 text-info" id="adminTodayAttendance">0</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5>User Management</h5>
                                <button class="btn btn-primary" onclick="showUserForm()">
                                    <i data-feather="plus"></i> Add User
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div id="adminUsersTable">
                                <div class="text-center text-muted">
                                    <i data-feather="users"></i>
                                    <p>Loading users...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recruitment Section -->
        <div id="recruitment-section" class="section hr-only" style="display: none;">
            <div class="row">
                <div class="col-12">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h1>Recruitment</h1>
                        <button class="btn btn-primary" onclick="showJobForm()">
                            <i data-feather="plus"></i> Post Job
                        </button>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5>Job Listings</h5>
                        </div>
                        <div class="card-body">
                            <div id="jobListings">
                                <div class="text-center text-muted">
                                    <i data-feather="briefcase"></i>
                                    <p>No job listings found</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5>Recent Applications</h5>
                        </div>
                        <div class="card-body">
                            <div id="recentApplications">
                                <div class="text-center text-muted">
                                    <i data-feather="file-text"></i>
                                    <p>No applications found</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tickets Section -->
        <div id="tickets-section" class="section tickets-section" style="display: none;">
            <div class="row">
                <div class="col-12">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h1>Support Tickets</h1>
                        <button class="btn btn-primary" onclick="showCreateTicketModal()">
                            <i data-feather="plus"></i> Create Ticket
                        </button>
                    </div>
                </div>
            </div>

            <!-- Ticket Filters -->
            <div class="ticket-filters">
                <div class="row">
                <div class="col-md-3">
                    <select class="form-select" id="ticketStatusFilter" onchange="filterTickets()">
                        <option value="">All Status</option>
                        <option value="open">Open</option>
                        <option value="in_progress">In Progress</option>
                        <option value="closed">Closed</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <select class="form-select" id="ticketCategoryFilter" onchange="filterTickets()">
                        <option value="">All Categories</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <select class="form-select" id="ticketPriorityFilter" onchange="filterTickets()">
                        <option value="">All Priority</option>
                        <option value="low">Low</option>
                        <option value="medium">Medium</option>
                        <option value="high">High</option>
                        <option value="urgent">Urgent</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <button class="btn btn-outline-secondary" onclick="clearTicketFilters()">
                        <i data-feather="x"></i> Clear Filters
                    </button>
                </div>
            </div>
            </div>

            <!-- Ticket Stats for HR/Admin -->
            <div class="row mb-4 hr-only" style="display: none;">
                <div class="col-md-6 col-lg-3">
                    <div class="stats-card">
                        <div class="stats-number" id="totalTickets">0</div>
                        <div class="stats-label">Total Tickets</div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3">
                    <div class="stats-card">
                        <div class="stats-number" id="openTickets">0</div>
                        <div class="stats-label">Open Tickets</div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3">
                    <div class="stats-card">
                        <div class="stats-number" id="urgentTickets">0</div>
                        <div class="stats-label">Urgent Tickets</div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3">
                    <div class="stats-card">
                        <div class="stats-number" id="unassignedTickets">0</div>
                        <div class="stats-label">Unassigned</div>
                    </div>
                </div>
            </div>

            <!-- Tickets List -->
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h5>Your Tickets</h5>
                        </div>
                        <div class="card-body">
                            <div id="ticketsList">
                                <div class="text-center text-muted">
                                    <i data-feather="loader"></i>
                                    <p>Loading tickets...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modals -->
    <div class="modal fade" id="leaveModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Apply for Leave</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="leaveForm">
                        <div class="mb-3">
                            <label class="form-label">Leave Type</label>
                            <select class="form-select" id="leaveType" required>
                                <option value="">Select leave type</option>
                                <option value="vacation">Vacation</option>
                                <option value="sick">Sick Leave</option>
                                <option value="personal">Personal</option>
                                <option value="emergency">Emergency</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Start Date</label>
                            <input type="date" class="form-control" id="leaveStartDate" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">End Date</label>
                            <input type="date" class="form-control" id="leaveEndDate" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Reason</label>
                            <textarea class="form-control" id="leaveReason" rows="3" required></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Submit Request</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- View Leave Modal -->
    <div class="modal fade" id="viewLeaveModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Leave Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <p><strong>Leave Type:</strong> <span id="viewLeaveType">-</span></p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>Status:</strong> <span id="viewLeaveStatus" class="badge bg-secondary">-</span></p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>Start Date:</strong> <span id="viewStartDate">-</span></p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>End Date:</strong> <span id="viewEndDate">-</span></p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>Days Requested:</strong> <span id="viewDaysRequested">-</span></p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>Created:</strong> <span id="viewLeaveCreated">-</span></p>
                        </div>
                        <div class="col-12">
                            <p><strong>Reason:</strong></p>
                            <p id="viewLeaveReason" class="text-muted">-</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Job Form Modal -->
    <div class="modal fade" id="jobModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Post New Job</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="jobForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="jobTitle" class="form-label">Job Title *</label>
                                    <input type="text" class="form-control" id="jobTitle" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="jobDepartment" class="form-label">Department *</label>
                                    <select class="form-select" id="jobDepartment" required>
                                        <option value="">Select Department</option>
                                        <option value="Engineering">Engineering</option>
                                        <option value="Human Resources">Human Resources</option>
                                        <option value="Marketing">Marketing</option>
                                        <option value="Sales">Sales</option>
                                        <option value="Finance">Finance</option>
                                        <option value="Operations">Operations</option>
                                        <option value="Customer Support">Customer Support</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="jobLocation" class="form-label">Location</label>
                                    <input type="text" class="form-control" id="jobLocation" placeholder="e.g. New York, Remote">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="jobEmploymentType" class="form-label">Employment Type</label>
                                    <select class="form-select" id="jobEmploymentType">
                                        <option value="full-time">Full-time</option>
                                        <option value="part-time">Part-time</option>
                                        <option value="contract">Contract</option>
                                        <option value="internship">Internship</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="jobSalaryMin" class="form-label">Minimum Salary</label>
                                    <input type="number" class="form-control" id="jobSalaryMin" placeholder="50000">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="jobSalaryMax" class="form-label">Maximum Salary</label>
                                    <input type="number" class="form-control" id="jobSalaryMax" placeholder="80000">
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="jobDescription" class="form-label">Job Description *</label>
                            <textarea class="form-control" id="jobDescription" rows="4" required placeholder="Describe the role, responsibilities, and what we're looking for..."></textarea>
                        </div>
                        
                        <div class="mb-3">
                            <label for="jobRequirements" class="form-label">Requirements</label>
                            <textarea class="form-control" id="jobRequirements" rows="3" placeholder="Education, experience, skills required..."></textarea>
                        </div>
                        
                        <div class="mb-3">
                            <label for="jobBenefits" class="form-label">Benefits</label>
                            <textarea class="form-control" id="jobBenefits" rows="3" placeholder="Health insurance, retirement plans, vacation time..."></textarea>
                        </div>
                        
                        <div class="mb-3">
                            <label for="jobClosesAt" class="form-label">Application Deadline</label>
                            <input type="date" class="form-control" id="jobClosesAt">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary" onclick="app.handlePostJob()">
                        <i data-feather="plus"></i> Post Job
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Ticket Modal -->
    <div class="modal fade" id="createTicketModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Create Support Ticket</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="createTicketForm" enctype="multipart/form-data">
                        <div class="mb-3">
                            <label for="ticketTitle" class="form-label">Title <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="ticketTitle" required maxlength="200" placeholder="Brief description of the issue">
                        </div>
                        
                        <div class="mb-3">
                            <label for="ticketDescription" class="form-label">Description <span class="text-danger">*</span></label>
                            <textarea class="form-control" id="ticketDescription" rows="5" required placeholder="Detailed description of the issue or request"></textarea>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="ticketCategory" class="form-label">Category <span class="text-danger">*</span></label>
                                    <select class="form-select" id="ticketCategory" required>
                                        <option value="">Select Category</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="ticketPriority" class="form-label">Priority</label>
                                    <select class="form-select" id="ticketPriority">
                                        <option value="low">Low</option>
                                        <option value="medium" selected>Medium</option>
                                        <option value="high">High</option>
                                        <option value="urgent">Urgent</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="ticketAttachment" class="form-label">Attachment (Optional)</label>
                            <input type="file" class="form-control" id="ticketAttachment" accept=".txt,.pdf,.png,.jpg,.jpeg,.gif,.doc,.docx,.xls,.xlsx">
                            <div class="form-text">Max file size: 16MB. Supported formats: txt, pdf, png, jpg, gif, doc, docx, xls, xlsx</div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary" onclick="createTicket()">
                        <i data-feather="plus"></i> Create Ticket
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Ticket Details Modal -->
    <div class="modal fade" id="ticketDetailsModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="ticketDetailsTitle">Ticket Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="ticketDetailsContent">
                    <!-- Ticket details will be loaded here -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Spinner -->
    <div id="loadingSpinner" class="position-fixed top-50 start-50 translate-middle" style="z-index: 9999; display: none;">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons@4.29.0/dist/feather.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.4.0/dist/axios.min.js"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    <script>
        // Initialize feather icons
        feather.replace();
        
        // Start the application
        document.addEventListener('DOMContentLoaded', function() {
            app.init();
        });
    </script>
</body>
</html>
